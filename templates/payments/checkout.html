{% extends "base.html" %}
{% load static %}

{% block title %}Pago · {{ field.name }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'payments/payments.css' %}">
{% endblock %}

{% block navbar_filters %}{% endblock %}

{% block content %}
<main class="pay-container">
  <section class="pay-header">
    <h1 class="pay-title">Simulación de pago</h1>
    <p class="pay-subtitle">
      Estás por reservar <strong>{{ field.name }}</strong>.
    </p>
  </section>

  <section class="pay-grid">
    <!-- Resumen izquierda -->
    <article class="pay-summary">
      <h2 class="pay-summary__title">Resumen de la reserva</h2>

      <div class="pay-summary__box">
        <p><span class="label">Fecha:</span> {{ start|date:"d/m/Y" }}</p>
        <p><span class="label">Horario:</span> {{ start|date:"H:i" }} – {{ end|date:"H:i" }}</p>
        <p><span class="label">Cancha:</span> {{ field.name }}</p>
        <p><span class="label">Tipo:</span> {{ field.get_type_display }}</p>
      </div>

      <div class="pay-total">
        <span class="pay-total__label">Total a pagar</span>
        <div class="pay-total__amount">
          <span class="currency">S/</span>
          <span class="value">{{ total|floatformat:2 }}</span>
        </div>
      </div>
    </article>

    <!-- Formulario derecha -->
    <article class="pay-panel">
      <h2 class="pay-panel__title">Datos de pago</h2>
      <p class="pay-panel__hint">
        Esta es una pasarela simulada. Ingresa los datos requeridos para completar la reserva.
      </p>

      <form method="post" class="pay-form">
        {% csrf_token %}

        {# === Hidden para conservar fecha y horas entre GET y POST === #}
        <input type="hidden" name="date" value="{{ start|date:'Y-m-d' }}">
        <input type="hidden" name="start_time" value="{{ start|date:'H:i' }}">
        <input type="hidden" name="end_time" value="{{ end|date:'H:i' }}">

        {# === Hidden para conservar extras seleccionados === #}
        {% for e in extras %}
          <input type="hidden" name="quantity_{{ e.fe.id }}" value="{{ e.quantity }}">
        {% endfor %}

        {# Renderizamos el form de Django, pero con estilos de tarjeta #}
        <div class="pay-form__fields">
          {% for field in form %}
            <div class="pay-field">
              {{ field.label_tag }}
              {{ field }}
              {% if field.help_text %}
                <small class="help">{{ field.help_text }}</small>
              {% endif %}
              {% for error in field.errors %}
                <div class="error">{{ error }}</div>
              {% endfor %}
            </div>
          {% endfor %}
        </div>

        <button type="submit" class="pay-btn">
          Pagar y crear reserva
        </button>
      </form>
    </article>
  </section>
</main>
{% endblock %}
